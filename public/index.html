<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- React-15.3.1 >
    <script src="javascripts/lib/react-15.3.1/react.min.js"></script>
    <script src="javascripts/lib/react-15.3.1/react-dom.min.js"></script>
    <script src="https://npmcdn.com/babel-core@5.8.38/browser.min.js"></script-->

    <!-- Vue.js v2.0.0-rc.3 -->
    <script src="javascripts/lib/vue/vue.js"></script>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="http://getbootstrap.com/dist/js/bootstrap.min.js"></script>

    <script>
        //VueJS ajax methods example: https://laracasts.com/discuss/channels/general-discussion/fetching-persisting-data-using-vuejs?page=1
        $( document ).ready(function() {
            $.userList();

            //$("input[name=submit]").click($.userAdd);
        });
        /*
        //get all
        $.ajaxTo('GET','/user', {});
        //get one
        $.ajaxTo('GET','/user/:id', {});
        //add list
        $.ajaxTo('POST','/user', [{
                                        name: 'Peter Quill 1',
                                        username: 'test_1',
                                        password: '1234',
                                        admin: true
                                    },{
                                        name: 'Peter Quill 2',
                                        username: 'test_2',
                                        password: '1234',
                                        admin: true
                                    }]);
        //add one
        $.ajaxTo('POST','/user/:id', {
                                        name: 'Peter Quill 1',
                                        username: 'test_1',
                                        password: '1234',
                                        admin: true
                                    });
        //modify list
        $.ajaxTo('PUT','/user', [{
                                        name: 'Peter Quill 1',
                                        username: 'test_1',
                                        password: '1234',
                                        admin: true
                                    },{
                                        name: 'Peter Quill 2',
                                        username: 'test_2',
                                        password: '1234',
                                        admin: true
                                    }]);
        //modify one
        $.ajaxTo('PUT','/user/:id', {
                                        name: 'Peter Quill 1',
                                        username: 'test_1',
                                        password: '1234',
                                        admin: true
                                    });
        //delete all
        $.ajaxTo('DELETE','/user', {});
        //delete one
        $.ajaxTo('DELETE','/user/:id', {});
        */

        $.ajaxTo = function(type, url, data) {
            var callback = {};
            $.ajax({
                url: url,
                async: false,
                data: data,
                type: type,
                dataType:'json',
                success: function(data2){
                  callback = data2;
                },
                error:function(e){ 
                  callback = e;
                }
            });
            return callback;
        }

        $.userList = function() {
            var users = $.ajaxTo('GET','/user', {});
            $.userList = new Vue({
              el: '#userList',
              data: {
                users: users
              }
            });
        }

        $.userAdd = function(e) {
            console.log(e);
            var data = {
                username: $("input[name=username]").val(),
                email: $("input[name=email]").val()
            }
            if($.ajaxTo('userAdd', data)) {
                alert("新增成功");
                $.userList($.ajaxTo('userList', {}));
            } else {
                alert("新增失敗");
            }
        }
    </script>
        <style>
            .user > p {
                font-weight: bold;
            }
            .user > p > span {
                font-weight: normal;
                margin-left: 5px;
            }
            .user {
                float: left;
                padding: 5px 20px;
                border: 1px solid black;
                margin-left: 10px;
                margin-bottom: 10px;
            }
        </style>
  </head>
  <body>

    <div>
      Username: <input type="text" name="username" placeholder="Enter Username">
      Email: <input type="email" name="email" placeholder="Enter Email">
      <input type="submit" name="submit" value="Submit">
    </div>

    <div id="userList">
        <div class="user" v-for="user in users" track-by="_id" style="border: 1px solid black; display: inline;">
            <p>name:<span>{{user.name}}</span></p>
            <p>age:<span>{{user.age}}</span></p>
            <p>location:<span>{{user.location}}</span></p>
            <p>created_at:<span>{{user.created_at}}</span></p>
            <p>updated_at:<span>{{user.updated_at}}</span></p>
        </div>
    </div>

  </body>
</html>